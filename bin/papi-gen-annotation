#!/usr/bin/env python
# -*- coding: utf-8

"""
Copyright (C) 2014, PaPi Authors

This program is free software; you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free
Software Foundation; either version 2 of the License, or (at your option)
any later version.

Please read the COPYING file.
"""
import sys
import argparse

import PaPi.parsers as parsers
from PaPi.utils import ConfigError
from PaPi.filesnpaths import FilesNPathsError

parser = argparse.ArgumentParser(description='Generate PaPi annotation object using available parsers')
parser.add_argument('input', metavar = 'FILE', nargs='+',
                    help = 'Input files')
parser.add_argument('-p', '--parser', default = 'myrast',
                    help = 'Parser. Available parsers: %s. Default: %s' % (', '.join(parsers.parsers.keys()), 'myrast'))
parser.add_argument('-o', '--output-prefix', default = "ANNOTATION", 
                    help = 'Output file prefix. Default prefix is "%(default)s.')

args = parser.parse_args()

try:
    if args.parser not in parsers.parsers:
        raise ConfigError, "I don't know what to do with '%s'. Please enter a valid parser. Here is a list of\
                            parsers available: %s" % (args.parser, ','.join(parsers.parsers))
    parser = parsers.parsers[args.parser](args.input, args.output_prefix)
except ConfigError, e:
    print e
    sys.exit(-1)
except FilesNPathsError, e:
    print e
    sys.exit(-2)