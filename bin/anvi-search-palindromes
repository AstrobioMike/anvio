#!/usr/bin/env python
# -*- coding: utf-8
"""A program to find palindromes in sequences."""

import sys

import anvio

from anvio.argparse import ArgumentParser
from anvio.sequencefeatures import Palindromes
from anvio.errors import ConfigError, FilesNPathsError


__author__ = "Developers of anvi'o (see AUTHORS.txt)"
__copyright__ = "Copyleft 2021, the Meren Lab (http://merenlab.org/)"
__license__ = "GPL 3.0"
__version__ = anvio.__version__
__authors__ = ['meren']
__requires__ = ["fasta", "contigs-db"]
__provides__ = ['palindromes-txt']
__description__ = "A program to find palindromes in sequences"


def main(args):
    if not (args.dna_sequence or args.contigs_db or args.fasta_file):
        raise ConfigError("You should send an input sequence source for this program to work.")

    if not args.output_file:
        args.verbose = True

    p = Palindromes(args)

    if args.contigs_db or args.fasta_file:
        p.process()
    elif args.dna_sequence:
        p.find(args.dna_sequence)
        p.report()


if __name__ == "__main__":
    parser = ArgumentParser(description=__description__)

    groupA = parser.add_argument_group('SEQUENCE SOURCE', "Where should anvi'o find your sequences?")
    groupA.add_argument(*anvio.A('contigs-db'), **anvio.K('contigs-db', {'required': False}))
    groupA.add_argument(*anvio.A('fasta-file'), **anvio.K('fasta-file'))
    groupA.add_argument(*anvio.A('dna-sequence'), **anvio.K('dna-sequence'))

    groupB = parser.add_argument_group('PALINDROME BUT HOW?', "Some essential stuff here about your palindromes")
    groupB.add_argument(*anvio.A('min-palindrome-length'), **anvio.K('min-palindrome-length'))
    groupB.add_argument(*anvio.A('max-num-mismatches'), **anvio.K('max-num-mismatches'))

    groupC = parser.add_argument_group('OUTPUT', "Output options.")
    groupC.add_argument(*anvio.A('output-file'), **anvio.K('output-file'))
    groupC.add_argument(*anvio.A('verbose'), **anvio.K('verbose'))

    args, unknown = parser.parse_known_args()

    try:
        main(args)
    except ConfigError as e:
        print(e)
        sys.exit(-1)
    except FilesNPathsError as e:
        print(e)
        sys.exit(-2)
