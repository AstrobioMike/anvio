#!/usr/bin/env python
# -*- coding: utf-8

# Copyright (C) 2014, A. Murat Eren
#
# This program is free software; you can redistribute it and/or modify it under
# the terms of the GNU General Public License as published by the Free
# Software Foundation; either version 2 of the License, or (at your option)
# any later version.
#
# Please read the COPYING file.

import sys
import argparse
import hcluster

import PaPi.terminal as terminal
import PaPi.clustering as clustering
from PaPi.profiler import __version__

from PaPi.utils import ConfigError
from PaPi.filesnpaths import FilesNPathsError
from PaPi.clusteringconfuguration import ClusteringConfiguration

progress = terminal.Progress()

parser = argparse.ArgumentParser(description='why yes we do stuff here.')
parser.add_argument('config_file', metavar = 'PATH', default = None, type=str,
                    help = 'Config file for clustering of contigs. See XXX for help.')
parser.add_argument('-i', '--input-directory', metavar = 'PATH', default = None, type=str,
                    help = 'Input directory to find matrix files')
parser.add_argument('-D', '--dry-run', default = False, action = 'store_true', 
                    help = 'Do not do anything, just print out the configuration.')

args = parser.parse_args()

try:
    config = ClusteringConfiguration(args.config_file, args.input_directory, __version__)
except ConfigError, e:
    print e
    sys.exit(-1)
except FilesNPathsError, e:
    print e
    sys.exit(-2)

# FIXME: This should take a Run argument.
config.print_summary(terminal.Run())

if args.dry_run:
    sys.exit()

clustering.order_contigs_simple(config, progress = terminal.Progress(), debug = True)
