<!DOCTYPE html>
<html lang="en">
    <head>
        <title id="window-title">Genome View</title>
        <meta name="google" value="notranslate">
        <meta charset="UTF-8" />
        <link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="./css/genomeview.css" />
        <!-- main css file imported for color picker functionality -->
        <link rel="stylesheet" type="text/css" href="./css/main.css" />
        <link rel="stylesheet" href="lib/colpick/colpick.css" type="text/css" />

        <link rel="shortcut icon" href="#">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script type="text/javascript" src="lib/d3.js/d3.min.js"></script>
        <script type="text/javascript" src="lib/jquery-svgpan/jquery-svgpan.js"></script>
        <script type="text/javascript" src="lib/jquery-ui/ui/core.js"></script>
        <script type="text/javascript" src="lib/jquery-ui/ui/widget.js"></script>
        <script type="text/javascript" src="lib/jquery-ui/ui/mouse.js"></script>
        <script type="text/javascript" src="lib/jquery-ui/ui/sortable.js"></script>
        <script type="text/javascript" src="lib/jquery-ui/ui/draggable.js"></script>
        <script type="text/javascript" src="lib/jquery-ui/ui/accordion.js"></script>
        <script type="text/javascript" src="lib/jquery-ui/ui/resizable.js"></script>
        <script type="text/javascript" src="lib/jquery-ui/ui/button.js"></script>
        <script type="text/javascript" src="lib/jquery-ui/ui/position.js"></script>
        <script type="text/javascript" src="lib/colpick/colpick.js"></script>
        <script type="text/javascript" src="./js/constants.js"></script>
        <script type="text/javascript" src="./js/genomeview.js"></script>
        <script type="text/javascript" src="./js/genomeview/main.js"></script>
        <script type="text/javascript" src="./js/genomeview/drawer.js"></script>
        <script type="text/javascript" src="./js/genomeview/scale.js"></script>
        <script type="text/javascript" src="./js/genomeview/ui.js"></script>
        <script type="text/javascript" src="./js/genomeview/utils.js"></script>

        <script src="./lib/fabric/dist/fabric.js"></script>
    </head>
    <body>
        <div class="container">
            <div id='labelAndMainContainer'>
              <canvas id="myCanvas" height="700px"></canvas>
            </div>
            <div id='scaleContainer'>
              <div id="scaleBox" height="140px">
                <svg id="scaleSvg" height="120px"></svg>
              </div>
              <button id="zoom-out" onclick="zoomOut()" style="float:right">-</button>
              <button id="zoom-in" onclick="zoomIn()" style="float:right; margin-right:5px">+</button>
              <input type="text" class="form-control input-sm" id="brush_start" style= "width: 60px; float:left; margin-right:10px" value="0"></input>
              <input type="text" class="form-control input-sm" id="brush_end" style= "width: 60px; float:left" value="0"></input>
              <select id='bookmarks-select' style= "width: 120px; float:left; margin-left:10px">
                <option selected="true" disabled="disabled">Bookmarks</option>
              </select>
              <p id='bookmark-description' style= "width: 300px; float:left; margin-left:10px; font-size: large;"></p>
            </div>
            <div id='tooltip-body' display='none'></div>

            <div id="toggle-panel-settings" onclick="toggleSettingsPanel()">
              <span id="toggle-panel-settings-inner">&#9664;</span><span style="display: block; font-size: 11px; transform: rotate(90deg);"><u>S</u>ETTINGS</span>
            </div>

            <div id="settings-panel">
                  <div id="sidebar">
                        <div class="tab-content"></div>

                        <span class="settings-header">Genome Arrangement</span>
                        <table id="genome-arrangement" style="margin-bottom: 20px;">
                          <tbody>
                            <tr>
                              <td>Genome spacing:</td>
                              <td><input type="text" class="form-control input-sm" id="genome_spacing" value="30"></td>
                            </tr>
                            <tr>
                              <td>Plot scale:</td>
                              <td><input type="text" class="form-control input-sm" id="plot_scale" value="(TODO)"></td>
                            </tr>
                            <tr>
                              <td>Align to Gene Cluster: </td>
                              <td><input id="alignClusterInput" class="form-control input-sm" type="text" value="" size="4"></td>
                            </tr>
                            <tr>
                              <td>Pan to Gene Cluster: </td>
                              <td><input id="panClusterInput" class="form-control input-sm" type="text" value="" size="4"></td>
                            </tr>
                            <tr>
                              <td>Order Method: </td>
                              <td><select class="type_multiple" id='genome_order_select' style="width: 100px;" class="type"></select></td>
                            </tr>
                          </tbody>
                        </table>

                        <span class="settings-header">Genomes</span>

                  <div id="table_layers_container" style="margin-top: 15px;">
                      <table id="table_genomes" class='sortable'>
                          <thead>
                              <tr>
                                  <td></td>
                                  <td data-help="layer-name">Name</td>
                                  <td data-help="layer-color"><div style="width: 32px;">Color</div></td>
                                  <td data-help="layer-type">Type</td>
                                  <td data-help="layer-norm">Norm.</td>
                                  <td data-help="layer-height">Height</td>
                                  <td data-help="layer-margin" class="column-margin">Margin</td>
                                  <td data-help="layer-min">Min</td>
                                  <td data-help="layer-max">Max</td>
                              </tr>
                          </thead>
                          <tbody id="tbody_genomes"></tbody>
                          <tbody id="tbody_bottom">
                              <tr style="height: 30px">
                                  <td colspan="9">
                                      <h4 style="padding-top: 10px; border-top: 1px #AAA solid;" data-help="edit-multiple-layers">Edit attributes for multiple layers</h4>
                                  </td>
                              </tr>
                              <tr>
                                  <td></td>
                                  <td><input class="select_layer" placeholder="Select Layer" size="12"></td>
                                  <td>
                                      <div id="picker_start_multiple" class="colorpicker-base" color="#FFFFFF" style="background-color: #FFFFFF"></div>
                                      <div id="picker_multiple" class="colorpicker-base" color="#FFFFFF" style="background-color: #FFFFFF" ></div>
                                  </td>
                                  <td style="width: 50px;">
                                      <select class="type_multiple" style="width: 50px;" class="type">
                                          <option value="">Select</option>
                                          <option value="" disabled>-----Numerical Types-----</option>
                                          <option value="bar">Bar</option>
                                          <option value="intensity">Intensity</option>
                                          <option value="line">Line</option>
                                          <option value="" disabled>-----Categorical Types-----</option>
                                          <option value="color">Color</option>
                                          <option value="text">Text</option>
                                      </select>
                                  </td>
                                  <td>
                                      <select class="normalization_multiple">
                                          <option value="">Select</option>
                                          <option value="none">none</option>
                                          <option value="sqrt">sqrt</option>
                                          <option value="log">log</option>
                                      </select>
                                  </td>
                                  <td><input class="input-height-multiple" size="3"></input></td>
                                  <td class="column-margin"><input class="input-margin-multiple" size="3"></input></td>
                                  <td><input class="input-min-multiple" size="4"></input></td>
                                  <td><input class="input-max-multiple" size="4"></input></td>
                                  <td><input type="checkbox" class="select_all"></td>
                              </tr>
                          </tbody>
                      </table>
                  </div>

                        <span class="settings-header">Group Layers</span>
                        <table id="additionalDataLayersTable" class='sortable' style="margin-bottom: 20px;">
                          <thead>
                            <tr>
                                <td></td>
                                <td data-help="layer-name">Name</td>
                                <td data-help="layer-color"><div style="width: 32px;">Color</div></td>
                                <td data-help="layer-height">Height</td>
                                <td data-help="layer-margin" class="column-margin">Margin</td>
                                <td data-help="layer-min">Show</td>
                            </tr>
                          </thead>
                          <tbody id='tbody_additionalDataLayers'>
                          </tbody>
                        </table>
                        <table id="adlCustomizationTable" style="margin-bottom: 20px;">
                          <tbody>
                            <tr>
                              <td>Display up to N data points for numeric layers: N = </td>
                              <td><input id="adl_pts_per_layer" class="form-control input-sm" type="text" value="10000" size="6"></td>
                            </tr>
                            <tr>
                              <td><button id="showAllADLPtsBtn" type="button" class="btn btn-primary btn-xs" onclick="showAllADLPts()" class="btn btn-outline-primary">Show all data points</button></td>
                            </tr>
                          </tbody>
                        </table>

                        <span class="settings-header">Scale</span>
                        <table id="scaleTable" style="margin-bottom: 20px;">
                          <tbody>
                            <tr id="dynamic_scale">
                              <td>Dynamic scale interval</td>
                              <td style="float: right"><div style="width: 20px;"><input id="show_dynamic_scale_box" type="checkbox" class="layer_selectors"></div></td>
                            </tr>
                            <tr id="scale_interval">
                              <td>Genome scale interval: </td>
                              <td><input id="genome_scale_interval" class="form-control input-sm" type="text" value="100" size="4"></td>
                            </tr>
                            <tr>
                              <td><button id="alignRulerBtn" type="button" class="btn btn-primary btn-xs" onclick="alignRulers()" class="btn btn-outline-primary">Align genome rulers</button></td>
                            </tr>
                          </tbody>
                        </table>
                        <span class="settings-header">Bookmarks</span>
                        <table id="bookmarksTable" style="margin-bottom: 20px;">
                          <tbody>
                            <tr id="create_bookmark">
                              <td><input id="create_bookmark_input" class="form-control input-sm" type="text" placeholder="New bookmark title" style="margin-bottom: 15px;"  size="4"></td>
                            <tr id="show_scale">
                              <td><textarea id="create_bookmark_description" class="form-control input-sm" type="text" placeholder="New bookmark description" style="margin-bottom: 15px; height: 85px;"  size="8"></textarea></td>
                            </tr>
                            <tr id="show_scale">
                              <td style="float: right"><button onclick='createBookmark()'>New Bookmark from Current Position</button></td>
                            </tr>
                            </tr>
                          </tbody>
                        </table>

                        <span class="settings-header">Gene arrows</span>
                        <p class="settings-section-info">Change colors of genes based on their functional annotations. You can also manually color genes temporarily. First, right-click on a gene. It will add the gene into the list below with a default color. Then, you can use the color picker next to it to set a color manually.</p>
                        <div class="form-group form-margin" style="margin-top: 10px; color: #000000">
                          <label id="arrow_style_label" style="padding-left: 0px;" class="col-md-4 settings-label" data-help="arrow_style" data-original-title="" title="">Arrow style:</label>
                          <div class="col-md-8">
                            <select id="arrow_style" style="margin-bottom: 10px" class="form-control input-xs">
                              <option value=1>Default</option>
                              <option value=2>Wide</option>
                              <option value=3>Pentagon</option>
                              <option value=4>Rect</option>
                            </select>
                          </div>
                        </div>
                        <div class="form-group form-margin" style="margin-top: 10px; color: #000000">
                          <label id="gene_colors_label" style="padding-left: 0px;" class="col-md-4 settings-label" data-help="gene_color_order" data-original-title="" title="">Color genes by:</label>
                          <div class="col-md-8">
                            <select id="gene_color_order" style="margin-bottom: 10px" class="form-control input-xs"></select>
                          </div>
                        </div>
                        <div id="table_function_colors_container" style="margin-top: 20px; color:black">
                          <table id="table_function_colors">
                            <thead id="thead_function_colors">
                              <td></td>
                              <td data-help="function-color"><div style="width: 32px;"><b>Color</b></div></td>
                              <td data-help="function-category"><b>Category</b></td>
                            </thead>
                            <tbody id="tbody_function_colors"></tbody>
                          </table>
                        </div>
                        <button type="button" class="btn btn-primary btn-xs" onclick="resetFunctionColors()" class="btn btn-outline-primary">Reset Function colors</button>

                        <span class="settings-header">Gene links</span>
                        <div class="form-group form-margin" style="margin-top: 10px; color: #000000">
                          <label id="link_style_label" style="padding-left: 0px;" class="col-md-4 settings-label" data-help="link_style" data-original-title="" title="">Link style:</label>
                          <div class="col-md-8">
                            <select id="link_style" style="margin-bottom: 10px" class="form-control input-xs">
                              <option value=1>Straight</option>
                              <option value=2>Curved</option>
                              <option value=3>Line</option>
                              <option value=4>None</option>
                            </select>
                          </div>
                        </div>
                            <select id="shade_by" style="margin-bottom: 10px" class="form-control input-xs">
                              <option value=1>Gene Cluster</option>
                              <option value=2>COG Category</option>
                              <option value=3>KEGG Category</option>
                              <option value=4>Custom</option>
                            </select>
                        <p>TODO: Color table for shades (with opacity option too?)</p>

                        <span class="settings-header">Labels</span>
                        <table id="labels-table" style="margin-bottom: 20px;">
                          <tbody>
                            <tr id="show_genome_labels">
                              <td>Show genome labels</td>
                              <td style="float: right"><div style="width: 20px;"><input id="show_genome_labels_box" type="checkbox" class="layer_selectors"></div></td>
                            </tr>
                            <tr>
                              <td>Genome label size:</td>
                              <td><input type="text" class="form-control input-sm" id="genome_label" value="15" style="margin-bottom: 10px"></td>
                            </tr>
                            <tr>
                              <td>Genome label color:</td>
                              <td><div class="colorpicker" id="genome_label_color" color="#000000" style="background-color: #000000; margin-bottom: 10px"></div></td>
                            </tr>
                            <tr id="show_gene_labels">
                              <td>Show gene labels</td>
                              <td style="float: right"><div style="width: 20px;"><input id="show_gene_labels_box" type="checkbox" class="layer_selectors"></div></td>
                            </tr>
                            <tr>
                              <td>Gene label size:</td>
                              <td><input type="text" class="form-control input-sm" id="gene_label" value="40" style="margin-bottom: 10px"></td>
                            </tr>
                            <tr>
                              <td>Gene label color:</td>
                              <td><div class="colorpicker" id="gene_label_color" color="#000000" style="background-color: #000000; margin-bottom: 10px"></div></td>
                            </tr>
                            <tr>
                              <td>Gene label position:</td>
                              <td><div class="col-md-8">
                                <select id="gene_text_pos" style="margin-bottom: 10px; margin-left: 0px" class="form-control input-xs">
                                  <option value='above'>Above</option>
                                  <option value='slanted'>Slanted</option>
                                  <option value='inside'>Inside</option>
                                </select>
                              </div></td>
                            </tr>
                          </tbody>
                        </table>

                        <span class="settings-header">Get Sequence for a Range or Selection</span>
                        <p class="settings-section-info">Using your mouse, you can make regional selections through the panel at the bottom of the genome view screen. Through this section you can make more precise selections by explicitly defining a range, and can get sequences for individual genomes within the selected region or for the entire genome.</p>

                        <div id="range-box"></div>
                        <button type="button" class="btn btn-primary btn-xs" onclick="show_sequence_modal('Sequence', page_header + '\n' + sequence);">Get the entire split sequence</button><br />
                        <button type="button" class="btn btn-primary btn-xs disabled btn-selection-sequence"  onclick="show_selected_sequence();" disabled>Get sequence of selected area</button><br />


                        <span class="settings-header">Overlay GC Content</span>
                        <p class="settings-section-info">GC content may explain some variation in coverage (<a href="http://merenlab.org/2016/12/14/coverage-variation/" target="_blank">more info on wavy coverage patterns</a>). Using this section you can overlay GC content signal on your mapping results. The GC content of the reference sequence calculated as the moving average of a 'sliding window' sampled every 'step size'.</p>
                        <table id="gc-overlay" style="margin-bottom: 20px;">
                          <tbody>
                            <tr>
                              <td>Sliding window size (nt):</td>
                              <td><input type="text" class="form-control input-sm" id="gc_window_size" value="30"></td>
                            </tr>
                            <tr>
                              <td>Step size:</td>
                              <td><input type="text" class="form-control input-sm" id="gc_step_size" value="20"></td>
                            </tr>
                            <tr>
                              <td>Color:</td>
                              <td><div class="colorpicker" id="gc_overlay_color" color="#008000" style="background-color: #008000"></div></td>
                            </tr>
                          </tbody>
                        </table>

                        <button type="button" class="btn btn-primary btn-xs" onclick="applyOverlayGCContent();">Apply overlay</button>
                        <button type="button" class="btn btn-primary btn-xs" onclick="resetOverlayGCContent();">Reset overlay</button>

                        <span class="settings-header">Set/Reset Maximum Values</span>
                        <p class="settings-section-info">The y-axis on the left hand-side of each plot is automatically sclaed per sample as a function of the maximum coverage value. Using this section you can change the y-axis maximum for each sample independently, or set a single value for all samples to make coverages more comparable.</p>
                        <button type="button" class="btn btn-primary btn-xs" onclick="showSetMaxValuesDialog()" class="btn btn-outline-primary">Set maximum values</button><br />
                        <button type="button" class="btn btn-primary btn-xs" onclick="resetMaxValues()" class="btn btn-outline-primary">Reset maximum values</button><br />

                        <br><br>
              </div>

              <div class="btn-group sidebar-footer" role="group" style="margin-top: 5px; padding-right: 20px; padding-bottom: 5px;">
                <button type="button" class="btn btn-default btn-sm" style="width: 50%; float: left; margin-top: 5px" onclick="showLoadStateWindow();" data-help="load-state-button" data-original-title="" title=""><span class="glyphicon glyphicon-floppy-open" aria-hidden="true"></span> Load State</button>
                <button type="button" class="btn btn-default btn-sm" style="width: 50%; float: left; margin-top: 5px" onclick="showSaveStateWindow();" data-help="save-state-button" disabled-in-read-only="true" data-original-title="" title=""><span class="glyphicon glyphicon-floppy-save" aria-hidden="true"></span> Save State</button>
              </div>
            </div>

            <!-- LOAD STATE -->
            <div class="modal fade" id="modLoadState" style="display: none">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button class="close" data-dismiss="modal" type="button"><span>&times;</span></button>
                            <h4 class="modal-title">Load State</h4>
                        </div>

                        <div class="modal-body">
                            <select class="form-control" size="10" id="loadState_list" ondblclick="loadState();" onchange="$('#loadState_lastmodified').html('Last modified: ' + $('#loadState_list option:selected').attr('lastmodified')); "></select>
                            <br />
                            <div id="loadState_lastmodified">Last modified: n/a</div>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" onclick="loadState();">Load</button>
                            <button class="btn btn-default" data-dismiss="modal" type="button">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SAVE STATE -->
            <div class="modal fade" id="modSaveState" style="display: none">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button class="close" data-dismiss="modal" type="button"><span>&times;</span></button>
                            <h4 class="modal-title">Save State</h4>
                        </div>

                        <div class="modal-body">
                            <div class="form-group">
                                <select class="form-control" id="saveState_list" size="10" onchange="$('#saveState_name').val(this.value);" ondblclick="saveState();"></select>
                            </div>
                            <div class="form-group">
                                    <label class="col-md-2 settings-label label-big" for="saveState_name">Name: </label>
                                    <div class="col-md-10">
                                        <input type="text" id="saveState_name" class="form-control" />
                                    </div>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" onclick="saveState();">Save</button>
                            <button class="btn btn-default" data-dismiss="modal" type="button">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
